function fixdata(e){for(var r="",a=0,t=10240;a<e.byteLength/t;++a)r+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*t,a*t+t)));return r+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*t)))}function ab2str(e){for(var r="",a=0,t=10240;a<e.byteLength/t;++a)r+=String.fromCharCode.apply(null,new Uint16Array(e.slice(a*t,a*t+t)));return r+=String.fromCharCode.apply(null,new Uint16Array(e.slice(a*t)))}function s2ab(e){for(var r=new ArrayBuffer(2*e.length),a=new Uint16Array(r),t=0;t!=e.length;++t)a[t]=e.charCodeAt(t);return[a,r]}function xw_noxfer(e,r){var a=new Worker(XW.noxfer);a.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;case XW.msg:r(JSON.parse(e.data.d))}};var t=rABS?e:btoa(fixdata(e));a.postMessage({d:t,b:rABS})}function xw_xfer(e,r){var a=new Worker(rABS?XW.rABS:XW.norABS);if(a.onmessage=function(e){switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;default:xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"),r(JSON.parse(xx))}},rABS){var t=s2ab(e);a.postMessage(t[1],[t[1]])}else a.postMessage(e,[e])}function xw(e,r){transferable?xw_xfer(e,r):xw_noxfer(e,r)}function process_wb(e){var r=[],a=$("#chartType").val();e.SheetNames.forEach(function(t){var n,o=e.Sheets[t],s=X.utils.sheet_to_row_object_array(o);switch(a){case"bar":var i,l,d=[],c=[];for(n in o)if(o.hasOwnProperty(n)){var f,h,u,y=/([A-Z]+)(\d+)/.exec(n),p={};if(!y)continue;if(f=y[1],h=y[2],"1"===h)"A"===f?i=o[n].v:(l=o[n].v,d.push(l));else if("A"===f)p.name=o[n].v,p.type="bar",p.data=[],c.push(p);else{var w=y[2]-2;u=o[n].v,c[w].data.push(u)}}r.xAxisName=i,r.xAxis=d,r.series=c;break;case"tree":var c=[];for(n in o)if(o.hasOwnProperty(n)){var f,h,x,m,y=/([A-Z]+)(\d+)/.exec(n),p={name:"",children:[]},v=!1,b=!1;if(!y)continue;matrix=y[0],f=y[1],h=y[2];for(childKey in o)if(o.hasOwnProperty(childKey)){var g=/([A-Z]+)(\d+)/.exec(childKey);if(!g)continue;if(g[1]===f){if(parseInt(g[2])<=parseInt(h))continue;x=parseInt(g[2]);break}}for(k in o)if(o.hasOwnProperty(k)){var A,S=/([A-Z]+)(\d+)/.exec(k),B={name:"",children:[]};if(!S)continue;if(A=S[1],kRow=parseInt(S[2]),A!==f&&v===!1)continue;if(A===f){v=!0;continue}b===!1&&(m=S[1],b=!0),A===m&&kRow>parseInt(h)&&kRow<x&&(B.name=o[k].v,p.children.push(B))}p.name=o[n].v,c.push(p),console.log(p);break}console.log(c);break;default:s.length>0&&(r=s)}}),data=r}function handleFile(e){var r=e.target.files,a=r[0],t=new FileReader;a.name;t.onload=function(e){var r=e.target.result;if(use_worker)xw(r,process_wb);else{var a;if(rABS)a=X.read(r,{type:"binary"});else{var t=fixdata(r);a=X.read(btoa(t),{type:"base64"})}process_wb(a)}},rABS?t.readAsBinaryString(a):t.readAsArrayBuffer(a)}var X=XLSX,XW={msg:"xlsx",rABS:"../../vendor/js-xlsx/xlsxworker2.js",norABS:"../../vendor/js-xlsx/xlsxworker1.js",noxfer:"../../vendor/js-xlsx/xlsxworker.js"},data,rABS="undefined"!=typeof FileReader&&"undefined"!=typeof FileReader.prototype&&"undefined"!=typeof FileReader.prototype.readAsBinaryString,use_worker=!!window.location.href.match("http://"),transferable=use_worker;require.config({paths:{echarts:"vendor/echarts"}}),$.fn.drawChart=function(e){var r=$(this);return charts=new $.charts(r,e),charts},$.charts=function(e,r){var a=$.extend({styles:$.charts.defaultStyles},r),t=this.getStyle(a),n=$.extend({style:t},r);this.selector=e,this.init(e,n)},$.extend($.charts,{defaults:{tree:{toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"树图",type:"tree",orient:"horizontal",rootLocation:{x:50,y:"50%"},nodePadding:25,layerPadding:100,hoverable:!1,roam:!0,symbolSize:6,itemStyle:{normal:{color:"#4883b4",label:{show:!0,position:"right",formatter:"{b}",textStyle:{color:"#000",fontSize:5}},lineStyle:{color:"#ccc",type:"broken"}},emphasis:{color:"#4883b4",label:{show:!1},borderWidth:0}},data:[]}]},wordCloud:{tooltip:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"字符雲",type:"wordCloud",size:["80%","80%"],textRotation:[0,45,90,-45],textPadding:0,autoSize:{enable:!0,minSize:14},data:[]}]},pie:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:[]},toolbox:{show:!0,feature:{dataView:{show:!1,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"餅圖",type:"pie",radius:"55%",itemStyle:{normal:{label:{position:"outer",formatter:function(e){return e.percent?e.name+e.percent+"%\n":e.name+e.value}}}},data:[]}]},bar:{toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",name:"",data:[],axisLabel:{show:!0,interval:0,rotate:45,margin:8,formatter:"{value}"}}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"}}],series:[]}},prototype:{getStyle:function(e){var r,a,t=e.styles,n=e.customStyle;for(a in t)a===n&&(r=t[a]);return r},init:function(e,r){var a=($(this),e.attr("id")),t=r,n=t.type;switch(n){case"tree":$.charts.prototype.drawTree(a,t);break;case"pie":$.charts.prototype.drawPie(a,t);break;case"wordCloud":$.charts.prototype.drawWordCloud(a,t);break;case"bar":$.charts.prototype.drawBar(a,t)}},drawTree:function(e,r){var a=$.extend($.charts.defaults.tree,r||{});require(["echarts","echarts/chart/tree"],function(r){var t=r.init(document.getElementById(e),"macarons");a.series[0].data=a.seriesData,t.setOption(a)})},drawWordCloud:function(e,r){var a=$.extend($.charts.defaults.wordCloud,r||{});require(["echarts","echarts/chart/wordCloud"],function(r){var t,n,o=r.init(document.getElementById(e),"macarons");for(t=0;t<a.seriesData.length;t++)n=a.seriesData[t],a.style&&(n.itemStyle=a.style());a.series[0].data=a.seriesData,o.setOption(a)})},drawPie:function(e,r){var a=$.extend($.charts.defaults.pie,r||{});require(["echarts","echarts/chart/pie","echarts/chart/funnel"],function(r){var t,n,o=r.init(document.getElementById(e),"infographic");for(t=0;t<a.seriesData.length;t++)n=a.seriesData[t],a.style&&(n.itemStyle=a.style());a.series[0].data=a.seriesData,o.setOption(a)})},drawBar:function(e,r){var a=$.extend($.charts.defaults.bar,r||{});require(["echarts","echarts/chart/bar","echarts/chart/line"],function(r){var t,n,o=r.init(document.getElementById(e),"macarons");for(t=0;t<a.seriesData.series.length;t++)n=a.seriesData.series[t],a.style&&(n.itemStyle=a.style());a.xAxis[0].data=a.seriesData.xAxis,a.xAxis[0].name=a.seriesData.xAxisName,a.series=a.seriesData.series,o.setOption(a)})}},defaultStyles:{darkStyle:function(){return{normal:{color:"rgb("+[Math.round(160*Math.random()),Math.round(160*Math.random()),Math.round(160*Math.random())].join(",")+")"}}},rainbowStyle:function(){return{normal:{color:function(e){var r=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return r[e.dataIndex]},textStyle:{fontFamily:"Microsoft Yahei, Arial, Verdana, sans-serif"}}}},wairoStyle:function(){return{normal:{color:function(e){var r=["#89C3EB","#83F6E8","#838BF6","#71C6D4","#7192D4","#AEDEFF","#9E773D","#EBC389","#4D7D9E","#7AAED1","#3F596B","#90CEF8"];return r[e.dataIndex]},textStyle:{fontFamily:"Microsoft Yahei, Arial, Verdana, sans-serif"}}}}},addStyle:function(e){$.extend($.charts.defaultStyles,e)}});